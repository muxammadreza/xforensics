<!DOCTYPE html>
<html lang="fa" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø´ÙØ§ÙÛŒØª | X Forensics</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTML2Canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <!-- Vazirmatn Font -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@33.003/misc/Farsi-Digits/Vazirmatn-FD-font-face.css" rel="stylesheet" type="text/css" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'monospace'],
                    },
                    colors: { slate: { 850: '#151f32', 950: '#020617' } },
                    animation: { 'fade-in-up': 'fadeInUp 0.5s ease-out forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body, input, button, select, textarea { font-family: 'Vazirmatn', sans-serif !important; }
        .dir-ltr { direction: ltr; text-align: left; }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-radius: 50%; border-top: 3px solid #3b82f6; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen flex flex-col font-sans overflow-x-hidden">

    <!-- Lightbox -->
    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-md hidden flex items-center justify-center p-4 cursor-zoom-out transition-opacity duration-300 opacity-0" onclick="closeLightbox()">
        <img id="lightbox-img" src="" class="max-w-full max-h-full rounded-lg shadow-2xl transform scale-95 transition-transform duration-300">
    </div>

    <!-- Navbar -->
    <nav class="border-b border-slate-800 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('list')">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-cyan-500 rounded-lg flex items-center justify-center font-bold text-white text-xl shadow-lg shadow-blue-500/20">X</div>
                    <span class="font-bold text-lg tracking-tight text-white">Ø³Ø§Ù…Ø§Ù†Ù‡ <span class="text-blue-400">Ø´ÙØ§ÙÛŒØª</span></span>
                </div>
                <a href="https://github.com/itsyebekhe/xforensics" target="_blank" class="text-sm text-slate-300 hover:text-white font-medium flex items-center gap-2">
                    <span class="hidden sm:inline">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø±</span> GitHub
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Hero Section -->
        <div id="hero-section" class="mb-10">
            <div class="relative bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-[2.5rem] p-8 md:p-12 overflow-hidden shadow-2xl shadow-slate-900/20 isolate border border-slate-700">
                <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 32px 32px;"></div>
                <div class="relative z-10 text-center md:text-right">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-green-400 text-xs font-bold mb-4">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø§Ø³Øª
                    </div>
                    <h1 class="text-3xl md:text-5xl font-black tracking-tight mb-4">Ø¢Ø±Ø´ÛŒÙˆ Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§ÛŒ <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-orange-400">Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ Ùˆ Ù…Ø´Ú©ÙˆÚ©</span></h1>
                    <p class="text-slate-400 text-lg max-w-2xl leading-relaxed mb-8">
                        Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ­Ù„ÛŒÙ„ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø§ØªØµØ§Ù„ØŒ ØªØºÛŒÛŒØ± Ù‡ÙˆÛŒØª Ùˆ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø³Ø§ÛŒØ¨Ø±ÛŒ Ø¯Ø± Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø§ÛŒÚ©Ø³.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-slate-950/50 p-4 rounded-2xl border border-white/5 text-center"><div class="text-xs text-slate-500 mb-1">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</div><div class="text-2xl font-black text-white" id="header-stat-total">0</div></div>
                        <div class="bg-slate-950/50 p-4 rounded-2xl border border-white/5 text-center"><div class="text-xs text-slate-500 mb-1">Ù…Ø´Ú©ÙˆÚ© / Ø¯Ø§Ø±Ø§ÛŒ ØªÚ¯</div><div class="text-2xl font-black text-yellow-400" id="header-stat-tagged">0</div></div>
                        <div class="bg-slate-950/50 p-4 rounded-2xl border border-white/5 text-center"><div class="text-xs text-slate-500 mb-1">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</div><div class="text-2xl font-black text-green-400" id="header-stat-android">0</div></div>
                        <div class="bg-slate-950/50 p-4 rounded-2xl border border-white/5 text-center"><div class="text-xs text-slate-500 mb-1">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¢ÛŒÙÙˆÙ†</div><div class="text-2xl font-black text-blue-400" id="header-stat-iphone">0</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div id="nav-tabs" class="flex justify-center mb-8 sticky top-20 z-40">
            <div class="bg-slate-900/90 backdrop-blur-xl p-1.5 rounded-2xl border border-slate-800 flex gap-2 shadow-lg overflow-x-auto max-w-full">
                <button onclick="switchView('list')" id="tab-list" class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all bg-blue-600 text-white shadow-sm whitespace-nowrap">ğŸ“‹ Ù„ÛŒØ³Øª Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</button>
                <button onclick="switchView('analytics')" id="tab-analytics" class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-400 hover:text-white hover:bg-white/5 whitespace-nowrap">ğŸ“Š Ø¢Ù…Ø§Ø± Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø±</button>
                <button onclick="switchView('lookup')" id="tab-lookup" class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-400 hover:text-white hover:bg-white/5 whitespace-nowrap">ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±</button>
                <button onclick="switchView('tools')" id="tab-tools" class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all text-slate-400 hover:text-white hover:bg-white/5 whitespace-nowrap">ğŸ› ï¸ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="flex flex-col items-center justify-center py-20 gap-4">
            <div class="loader w-12 h-12 border-4"></div>
            <p class="text-slate-400 text-sm animate-pulse">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¯ÛŒØªØ§Ø¨ÛŒØ³...</p>
        </div>

        <!-- APP CONTENT -->
        <div id="app-content" class="hidden">
            
            <!-- 1. LIST VIEW -->
            <div id="view-list" class="view-section">
                <div class="mb-6">
                    <div class="bg-slate-900 border border-slate-800 p-2 rounded-2xl flex flex-col md:flex-row gap-2">
                        <input type="text" id="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒØŒ Ø´Ù†Ø§Ø³Ù‡ Ø¹Ø¯Ø¯ÛŒ ÛŒØ§ ØªÚ¯â€ŒÙ‡Ø§..." class="flex-grow bg-slate-950 px-4 py-3 rounded-xl border border-transparent focus:border-blue-500/50 outline-none transition-all text-sm font-medium text-white placeholder-slate-600">
                        <select id="sort-select" class="bg-slate-950 text-slate-300 font-bold text-sm rounded-xl py-3 px-4 border border-transparent outline-none">
                            <option value="newest">Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† (ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª)</option>
                            <option value="oldest">Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†</option>
                        </select>
                    </div>
                </div>
                <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"></div>
                <div id="pagination" class="flex justify-center items-center gap-4 mt-12 mb-8 text-sm text-slate-400 font-sans"></div>
            </div>

            <!-- 2. ANALYTICS VIEW -->
            <div id="view-analytics" class="view-section hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800"><div class="text-xs text-slate-500 font-bold mb-1">Ú©Ù„ Ù…ÙˆØ§Ø±Ø¯ Ø«Ø¨Øª Ø´Ø¯Ù‡</div><div class="text-3xl font-black text-white" id="anl-total">0</div></div>
                    <div class="bg-green-900/10 p-5 rounded-xl border border-green-900/20"><div class="text-xs text-green-500 font-bold mb-1">Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</div><div class="text-3xl font-black text-green-500" id="anl-android">0</div></div>
                    <div class="bg-blue-900/10 p-5 rounded-xl border border-blue-900/20"><div class="text-xs text-blue-500 font-bold mb-1">Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„ Ø¢ÛŒÙÙˆÙ†</div><div class="text-3xl font-black text-blue-500" id="anl-iphone">0</div></div>
                    <div class="bg-slate-800 p-5 rounded-xl border border-slate-700"><div class="text-xs text-slate-400 font-bold mb-1">ÙˆØ¨ / Ø³Ø§ÛŒØ±</div><div class="text-3xl font-black text-slate-400" id="anl-web">0</div></div>
                </div>
                <!-- Clusters and Timeline -->
                <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 mb-8">
                    <div class="flex items-center gap-2 mb-6"><div class="w-1 h-5 bg-red-500 rounded-full"></div><h4 class="text-sm font-bold text-slate-200">Ú©Ù…Ù¾ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ (Ø®ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ)</h4></div>
                    <div id="clusters-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
                </div>
                <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
                    <div class="flex items-center gap-2 mb-6"><div class="w-1 h-5 bg-blue-500 rounded-full"></div><h4 class="text-sm font-bold text-slate-200">ØªÙˆØ²ÛŒØ¹ Ø³Ø§Ù„Ø§Ù†Ù‡ Ø³Ø§Ø®Øª Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</h4></div>
                    <div id="timeline-chart" class="flex items-end gap-3 h-48 overflow-x-auto pb-2 px-2 scrollbar-hide"></div>
                </div>
            </div>

            <!-- 3. LOOKUP VIEW -->
            <div id="view-lookup" class="view-section hidden">
                <div class="max-w-2xl mx-auto text-center mb-10">
                    <h2 class="text-2xl font-bold text-white mb-4">Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙˆØ¶Ø¹ÛŒØª Ø§Ú©Ø§Ù†Øª</h2>
                    <div class="relative">
                        <input type="text" id="lookup-input" placeholder="Ù…Ø«Ø§Ù„: elonmusk" class="w-full text-center text-xl font-bold bg-slate-900 py-5 px-6 rounded-2xl border-2 border-slate-800 focus:border-blue-500 outline-none transition-all dir-ltr text-white">
                        <button onclick="performLookup()" class="absolute left-3 top-3 bottom-3 bg-blue-600 hover:bg-blue-700 text-white px-6 rounded-xl font-bold transition-all">Ø¨Ø±Ø±Ø³ÛŒ</button>
                    </div>
                </div>
                <div id="lookup-result" class="max-w-md mx-auto"></div>
            </div>

            <!-- 4. TOOLS VIEW -->
            <div id="view-tools" class="view-section hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto mb-8">
                    <!-- Tool 1 -->
                    <div class="bg-slate-900 rounded-3xl border border-slate-800 p-8 shadow-xl">
                        <div class="flex items-center gap-4 mb-6"><div class="w-12 h-12 bg-blue-500/10 text-blue-500 rounded-2xl flex items-center justify-center text-2xl">ğŸ“</div><div><h3 class="text-lg font-bold text-white">ØªØ¨Ø¯ÛŒÙ„ Backup Ø¨Ù‡ Ù„ÛŒØ³Øª</h3><p class="text-xs text-slate-400">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² ÙØ§ÛŒÙ„ JSON</p></div></div>
                        <div class="border-2 border-dashed border-slate-700 rounded-2xl p-8 text-center hover:border-blue-500 transition-colors cursor-pointer bg-slate-950/50" onclick="document.getElementById('tool-json-input').click()"><input type="file" id="tool-json-input" accept=".json" class="hidden" onchange="handleJsonTool(this)"><div class="text-4xl mb-4">ğŸ“‚</div><div class="text-sm font-bold text-slate-300">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ JSON</div></div>
                    </div>
                    <!-- Tool 2 -->
                    <div class="bg-slate-900 rounded-3xl border border-slate-800 p-8 shadow-xl">
                        <div class="flex items-center gap-4 mb-6"><div class="w-12 h-12 bg-green-500/10 text-green-500 rounded-2xl flex items-center justify-center text-2xl">ğŸ“¥</div><div><h3 class="text-lg font-bold text-white">Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù„Ø§Ú¯ Ø¬Ø³ØªØ¬Ùˆ</h3><p class="text-xs text-slate-400">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø§Ø¨Ø²Ø§Ø±</p></div></div>
                        <div class="border-2 border-dashed border-slate-700 rounded-2xl p-8 text-center hover:border-green-500 transition-colors cursor-pointer bg-slate-950/50" onclick="document.getElementById('tool-dump-input').click()"><input type="file" id="tool-dump-input" accept=".json" class="hidden" onchange="handleDumpTool(this)"><div class="text-4xl mb-4">ğŸ“Š</div><div class="text-sm font-bold text-slate-300">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Dump</div></div>
                    </div>
                </div>

                <!-- NEW: EXTERNAL DATABASE SEARCH -->
                <div class="bg-slate-900 rounded-3xl border border-slate-800 p-8 shadow-xl max-w-4xl mx-auto mb-8">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-12 h-12 bg-purple-500/10 text-purple-500 rounded-2xl flex items-center justify-center text-2xl">ğŸ”</div>
                        <div>
                            <h3 class="text-lg font-bold text-white">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ (BData)</h3>
                            <p class="text-xs text-slate-400">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¹Ù…ÙˆÙ…ÛŒ HuggingFace Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù…ØŒ Ú©Ø¯Ù…Ù„ÛŒ ÛŒØ§ Ù…ÙˆØ¨Ø§ÛŒÙ„</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input type="text" id="ext-name" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ (Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ)" class="bg-slate-950 px-4 py-3 rounded-xl border border-slate-700 focus:border-purple-500/50 outline-none text-sm text-white transition-all">
                        <input type="text" id="ext-code" placeholder="Ú©Ø¯ Ù…Ù„ÛŒ (Û±Û° Ø±Ù‚Ù…)" class="bg-slate-950 px-4 py-3 rounded-xl border border-slate-700 focus:border-purple-500/50 outline-none text-sm text-white transition-all dir-ltr text-center">
                        <input type="text" id="ext-mobile" placeholder="Ù…ÙˆØ¨Ø§ÛŒÙ„ (0912...)" class="bg-slate-950 px-4 py-3 rounded-xl border border-slate-700 focus:border-purple-500/50 outline-none text-sm text-white transition-all dir-ltr text-center">
                    </div>
                    
                    <button onclick="handleExternalSearch()" class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-purple-600/20">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</button>

                    <!-- Ext Results -->
                    <div id="ext-results" class="hidden mt-6 overflow-x-auto rounded-xl border border-slate-700">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead class="bg-slate-950 text-slate-300 uppercase font-mono text-xs">
                                <tr>
                                    <th class="px-4 py-3 text-right">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</th>
                                    <th class="px-4 py-3 text-center">Ú©Ø¯ Ù…Ù„ÛŒ</th>
                                    <th class="px-4 py-3 text-center">Ù…ÙˆØ¨Ø§ÛŒÙ„</th>
                                    <th class="px-4 py-3 text-right">Ù†Ø§Ù… Ù¾Ø¯Ø±</th>
                                </tr>
                            </thead>
                            <tbody id="ext-results-body" class="divide-y divide-slate-800 bg-slate-900/50"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Dump Result Area (Hidden initially) -->
                <div id="dump-result-area" class="hidden mt-8 bg-slate-900 rounded-3xl border border-slate-800 overflow-hidden max-w-6xl mx-auto">
                    <div class="p-4 bg-slate-800/50 border-b border-slate-800 flex justify-between items-center"><h3 class="font-bold text-sm">Ù†ØªØ§ÛŒØ¬ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡</h3><button onclick="document.getElementById('dump-result-area').classList.add('hidden')" class="text-xs text-red-400 hover:text-red-300">Ø¨Ø³ØªÙ† Ù¾Ù†Ø¬Ø±Ù‡</button></div>
                    <div class="overflow-x-auto"><table class="w-full text-left text-sm text-slate-400"><thead class="bg-slate-950 text-slate-200 uppercase font-mono text-xs"><tr><th class="px-6 py-3">ØªØ§Ø±ÛŒØ®</th><th class="px-6 py-3">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th><th class="px-6 py-3">Ù…ØªÙ† ØªÙˆÛŒÛŒØª</th><th class="px-6 py-3">Ù„ÛŒÙ†Ú©</th></tr></thead><tbody id="dump-table-body" class="divide-y divide-slate-800"></tbody></table></div>
                </div>
            </div>

            <!-- 5. PROFILE VIEW (UPDATED) -->
            <div id="view-profile" class="view-section hidden">
                <button onclick="switchView('list')" class="mb-4 px-4 py-2 bg-slate-800 rounded-lg text-sm text-slate-300 hover:text-white flex items-center gap-2 transition-colors"><span>â†</span> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</button>
                <div class="bg-slate-900 rounded-[2rem] border border-slate-800 overflow-hidden shadow-2xl">
                    <!-- Profile Header -->
                    <div class="relative bg-slate-800 h-32 md:h-48">
                        <div class="absolute inset-0 opacity-20 bg-[url('https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png')] bg-cover bg-center blur-xl"></div>
                    </div>
                    <div class="px-8 pb-8">
                        <div class="relative flex justify-between items-end -mt-16 mb-6">
                            <img id="pf-avatar" src="" class="w-32 h-32 rounded-3xl border-8 border-slate-900 shadow-xl bg-slate-800 object-cover cursor-zoom-in" onclick="openLightbox(this.src)">
                            <div class="flex gap-2 mb-2">
                                <a id="pf-link-live" href="#" target="_blank" class="px-4 py-2 bg-white text-black hover:bg-slate-200 rounded-xl font-bold text-sm shadow-lg transition-all">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± X</a>
                            </div>
                        </div>
                        <div class="mb-6">
                            <h1 id="pf-name" class="text-3xl font-black text-white mb-1 dir-ltr text-right">@User</h1>
                            <div id="pf-id" class="font-mono text-slate-400 text-sm select-all dir-ltr text-right">ID: 000000</div>
                        </div>
                        <div id="pf-tags" class="flex flex-wrap gap-2 mb-8 justify-end"></div>

                        <!-- Data Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center"><div class="text-xs text-slate-500 uppercase font-bold mb-1">Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡</div><div id="pf-dev" class="text-lg font-bold text-white dir-ltr">-</div></div>
                            <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center"><div class="text-xs text-slate-500 uppercase font-bold mb-1">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª Ø§Ú©Ø§Ù†Øª</div><div id="pf-date" class="text-lg font-bold text-white dir-ltr">-</div></div>
                            <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center"><div class="text-xs text-slate-500 uppercase font-bold mb-1">Ù„ÙˆÚ©ÛŒØ´Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡</div><div id="pf-loc" class="text-lg font-bold text-white dir-ltr">-</div></div>
                        </div>

                        <!-- LOGS SECTION (SMART LOADING) -->
                        <div class="border-t border-slate-800 pt-8">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <span class="w-2 h-6 bg-blue-500 rounded-full"></span>
                                Ø¢Ø±Ø´ÛŒÙˆ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ (Logs)
                            </h3>
                            <p class="text-xs text-slate-400 mb-6">Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:</p>
                            
                            <!-- Static Link -->
                            <a id="btn-link-replies" href="#" target="_blank" class="block w-full mb-6 p-4 bg-slate-800/50 border border-slate-700 hover:bg-slate-800 text-slate-300 rounded-xl font-bold transition-all flex justify-between items-center group text-sm">
                                <span>ğŸ’¬ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ¹Ø§Ù…Ù„Ø§Øª Ùˆ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ (X Search)</span>
                                <span class="text-slate-500 group-hover:-translate-x-1 transition-transform">â†—</span>
                            </a>

                            <!-- Dynamic Buttons Container -->
                            <div id="log-buttons-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mb-6">
                                <div class="col-span-full text-center text-xs text-slate-500 py-4 animate-pulse">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯...</div>
                            </div>

                            <!-- Log Viewer Container -->
                            <div id="log-viewer" class="hidden bg-black rounded-2xl border border-slate-800 overflow-hidden">
                                <div class="bg-slate-900 px-4 py-2 border-b border-slate-800 flex justify-between items-center">
                                    <span id="log-status" class="text-xs font-mono text-yellow-500">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</span>
                                    <button onclick="document.getElementById('log-viewer').classList.add('hidden')" class="text-red-500 text-xs font-bold hover:text-red-400">Ø¨Ø³ØªÙ†</button>
                                </div>
                                <div class="max-h-96 overflow-y-auto">
                                    <table class="w-full text-left text-xs text-slate-400 font-mono">
                                        <thead class="bg-slate-950 text-slate-500 sticky top-0"><tr><th class="p-3 text-right w-32">ØªØ§Ø±ÛŒØ®</th><th class="p-3 text-right">Ù…ØªÙ† ØªÙˆÛŒÛŒØª</th><th class="p-3 w-16">Ù„ÛŒÙ†Ú©</th></tr></thead>
                                        <tbody id="log-body" class="divide-y divide-slate-800"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Export Template (Hidden) -->
    <div style="position: fixed; left: -2000px; top: 0; width: 600px; height: 600px; overflow: hidden; z-index: -1;">
        <div id="export-template" class="w-[600px] h-[600px] bg-slate-950 relative overflow-hidden flex flex-col justify-center items-center p-8 text-white font-sans">
            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#334155 1px, transparent 1px); background-size: 24px 24px;"></div>
            <div class="relative z-10 w-full bg-slate-900/80 backdrop-blur-md rounded-3xl border border-white/10 p-8 shadow-2xl">
                <div class="flex justify-between items-center mb-8 border-b border-white/5 pb-6">
                    <div class="flex items-center gap-3"><div class="w-3 h-3 bg-red-500 rounded-full"></div><span id="exp-r" dir="rtl" class="text-sm font-bold tracking-widest text-red-500 uppercase">DETECTED</span></div>
                    <div class="text-xs text-slate-500 font-mono">X Forensics DB</div>
                </div>
                <div class="flex items-start gap-6 mb-4">
                    <img id="exp-a" src="" class="w-24 h-24 rounded-2xl border-4 border-slate-800 shadow-xl object-cover flex-shrink-0" crossorigin="anonymous">
                    <div class="flex-1 min-w-0 pt-1"><div id="exp-u" dir="ltr" class="text-2xl font-black mb-1 break-all leading-tight text-left"></div><div id="exp-i" class="text-sm text-slate-400 font-mono tracking-wider"></div></div>
                </div>
                <div id="exp-tags" class="flex flex-wrap gap-2 mb-6 justify-end"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-950/50 rounded-xl p-4 border border-white/5"><div class="text-[10px] text-slate-500 uppercase font-bold mb-1">Device</div><div id="exp-d" dir="ltr" class="font-bold text-slate-200 text-xs text-left"></div></div>
                    <div class="bg-slate-950/50 rounded-xl p-4 border border-white/5"><div class="text-[10px] text-slate-500 uppercase font-bold mb-1">Created</div><div id="exp-c" dir="ltr" class="font-bold text-slate-200 text-left"></div></div>
                    <div class="col-span-2 bg-slate-950/50 rounded-xl p-4 border border-white/5"><div class="text-[10px] text-slate-500 uppercase font-bold mb-1">Location</div><div id="exp-l" dir="ltr" class="font-bold text-slate-200 text-left"></div></div>
                </div>
            </div>
            <div class="relative z-10 mt-8 text-center opacity-50"><div class="text-[10px] tracking-[0.3em] uppercase mb-2">Security Analysis Report</div></div>
        </div>
    </div>

    <script>
        const DB_URL = "https://raw.githubusercontent.com/itsyebekhe/xforensics/main/database.json";
        const LOGS_BASE_URL = "https://raw.githubusercontent.com/itsyebekhe/xforensics/main/logs";
        const ITEMS_PER_PAGE = 30;
        const PERSIAN_NUMS = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
        const ENGLISH_NUMS = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

        // --- Log Types Configuration ---
        const KNOWN_LOG_TYPES = [
            { id: 'war', label: 'Ø¬Ù†Ú¯ Û±Û² Ø±ÙˆØ²Ù‡', color: 'yellow' },
            { id: 'monarchy', label: 'Ù¾Ù‡Ù„ÙˆÛŒ / Ø³Ù„Ø·Ù†Øª', color: 'purple' },
            { id: 'regime', label: 'Ù†Ø¸Ø§Ù… / Ø§Ù†Ù‚Ù„Ø§Ø¨', color: 'red' },
            { id: 'military', label: 'Ù†Ø¸Ø§Ù…ÛŒ / Ø³Ù¾Ø§Ù‡', color: 'green' },
            { id: 'israel', label: 'Ø§Ø³Ø±Ø§Ø¦ÛŒÙ„ / Ø±Ú˜ÛŒÙ…', color: 'blue' },
            { id: 'civilian', label: 'Ú©Ø´ØªÙ‡â€ŒÙ‡Ø§ / Ø¢Ø¨Ø§Ù†', color: 'red' }
        ];

        let fullDatabase = {}, allData = [], filteredData = [], currentPage = 1, currentProfileUser = "", currentProfileId = "";
        
        const toEnglishDigits = (str) => { if (!str) return ""; return String(str).replace(/[Û°-Û¹]/g, w => ENGLISH_NUMS[PERSIAN_NUMS.indexOf(w)]); };

        // --- UTILS: EXTERNAL SEARCH ---
        function normalizePersian(text) {
            if (!text) return "";
            return text.replace(/ÙŠ/g, "ÛŒ").replace(/Ùƒ/g, "Ú©").replace(/Ù‰/g, "ÛŒ").trim();
        }

        async function searchDatabase({ nationalCode, fullName, mobile }) {
            const BASE_URL = "https://datasets-server.huggingface.co/search";
            const DATASET = "yebekhe/bdata";
            const CONFIG = "default";
            const SPLIT = "train";

            // The /search endpoint accepts a SINGLE 'query' string.
            // We prioritize: National Code > Mobile > Name
            let queryTerm = "";

            if (nationalCode) {
                // Search exact code. Search engine usually finds it even without leading zero.
                queryTerm = nationalCode.trim();
            } else if (mobile) {
                queryTerm = mobile.trim();
            } else if (fullName) {
                queryTerm = normalizePersian(fullName);
            }

            if (!queryTerm) return [];

            // Construct URL
            const url = `${BASE_URL}?dataset=${DATASET}&config=${CONFIG}&split=${SPLIT}&query=${encodeURIComponent(queryTerm)}&length=20`;

            console.log("Searching:", url);

            try {
                const response = await fetch(url);
                
                // Handle API Errors (e.g., Search not ready, 500 error)
                if (!response.ok) {
                    const errText = await response.text();
                    console.error("HF API Error:", errText);
                    throw new Error("Search API Error");
                }
                
                const data = await response.json();
                
                // The /search endpoint returns: { rows: [ { row: { ...data... } } ] }
                if (data.rows && Array.isArray(data.rows)) {
                    return data.rows.map(item => item.row);
                }
                return [];

            } catch (error) {
                console.error("Search Request Failed:", error);
                return [];
            }
        }

        async function handleExternalSearch() {
            const name = document.getElementById('ext-name').value;
            const code = document.getElementById('ext-code').value;
            const mobile = document.getElementById('ext-mobile').value;
            const btn = document.querySelector('button[onclick="handleExternalSearch()"]');
            const resultDiv = document.getElementById('ext-results');
            const tbody = document.getElementById('ext-results-body');

            if (!name && !code && !mobile) return alert("Ù„Ø·ÙØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© ÙÛŒÙ„Ø¯ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.");

            btn.disabled = true;
            btn.innerHTML = `<span class="loader w-4 h-4 border-2 border-t-transparent inline-block mr-2"></span> Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...`;
            resultDiv.classList.add('hidden');

            const results = await searchDatabase({ nationalCode: code, fullName: name, mobile: mobile });

            if (results && results.length > 0) {
                tbody.innerHTML = "";
                results.forEach(row => {
                    tbody.innerHTML += `
                    <tr class="hover:bg-slate-800/50 transition-colors">
                        <td class="px-4 py-3 text-right font-bold text-white">${row.FULL_NAME || '-'}</td>
                        <td class="px-4 py-3 text-center font-mono text-slate-400 select-all">${row.NATIONAL_CODE || '-'}</td>
                        <td class="px-4 py-3 text-center font-mono text-slate-400 select-all">${row.MOBILE || '-'}</td>
                        <td class="px-4 py-3 text-right text-slate-500">${row.FATHER_NAME || '-'}</td>
                    </tr>`;
                });
                resultDiv.classList.remove('hidden');
            } else {
                alert("Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
            }

            btn.disabled = false;
            btn.innerHTML = "Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡";
        }

        // --- APP INIT ---
        async function init() {
            try {
                const response = await fetch(`${DB_URL}?t=${Date.now()}`);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const json = await response.json();
                processData(json);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('loading').innerHTML = `<div class="text-center"><p class="text-red-500 font-bold text-lg mb-2">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯ÛŒØªØ§Ø¨ÛŒØ³</p><p class="text-slate-500 text-sm dir-ltr font-mono">${error.message}</p><button onclick="location.reload()" class="mt-4 px-4 py-2 bg-slate-800 rounded-lg text-sm hover:bg-slate-700">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button></div>`;
            }
        }

        function processData(rawData) {
            fullDatabase = rawData; allData = [];
            let stats = { total: 0, android: 0, iphone: 0, web: 0, tagged: 0 };
            
            for (const [username, info] of Object.entries(rawData)) {
                if (!info || !info.data) continue;
                const d = info.data;
                const isTarget = (d.countryCode === "Iran" || d.countryCode === "West Asia");
                const hasTags = info.tags && Array.isArray(info.tags) && info.tags.length > 0;
                
                if ((isTarget && d.isAccurate === true) || hasTags) {
                    if (hasTags) stats.tagged++;
                    stats.total++;
                    const dev = (d.device || "unknown").toLowerCase();
                    if (dev.includes("android")) stats.android++; else if (dev.includes("iphone")) stats.iphone++; else stats.web++;
                    
                    allData.push({
                        u: username, i: d.id || "0", a: d.avatar || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png",
                        d: d.device || "Unknown", l: d.country || d.countryCode || "Unknown", c: d.created || "-",
                        tags: info.tags || [], risk: d.riskLabel || "INFO", norm_date: toEnglishDigits(d.created || "")
                    });
                }
            }
            safeSetText('header-stat-total', stats.total.toLocaleString('fa-IR'));
            safeSetText('header-stat-tagged', stats.tagged.toLocaleString('fa-IR'));
            safeSetText('header-stat-android', stats.android.toLocaleString('fa-IR'));
            safeSetText('header-stat-iphone', stats.iphone.toLocaleString('fa-IR'));
            if(document.getElementById('anl-total')) renderAnalytics(stats);
            filterList();
        }
        function safeSetText(id, text) { const el = document.getElementById(id); if (el) el.textContent = text; }

        function filterList() {
            const query = toEnglishDigits(document.getElementById('search-input').value.toLowerCase().trim());
            const sort = document.getElementById('sort-select').value;
            filteredData = allData.filter(item => item.u.toLowerCase().includes(query) || item.i.includes(query) || item.norm_date.includes(query) || item.tags.some(t=>t.includes(query)));
            filteredData.sort((a, b) => sort === 'oldest' ? a.i.length - b.i.length || a.i.localeCompare(b.i) : b.i.length - a.i.length || b.i.localeCompare(a.i));
            currentPage = 1; renderList();
        }

        function renderList() {
            const container = document.getElementById('results-grid');
            if(!container) return;
            container.innerHTML = "";
            const items = filteredData.slice((currentPage - 1) * ITEMS_PER_PAGE, currentPage * ITEMS_PER_PAGE);
            if (items.length === 0) { container.innerHTML = `<div class="col-span-full text-center py-12 text-slate-500 border border-dashed border-slate-800 rounded-2xl">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>`; renderPagination(0); return; }
            items.forEach(user => {
                const avatar = user.a;
                const riskColor = user.d.toLowerCase().includes('android') ? 'bg-red-500' : 'bg-orange-500';
                container.innerHTML += `
                <div class="group relative bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden hover:border-slate-600 transition-all hover:-translate-y-1 duration-300 cursor-pointer shadow-lg" onclick="openProfile('${user.u}')">
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 ${riskColor} opacity-70"></div>
                    <div class="p-5 pl-7">
                        <div class="flex items-center gap-3 mb-4">
                            <img src="${avatar}" class="w-12 h-12 rounded-xl object-cover ring-2 ring-slate-800 bg-slate-800" loading="lazy">
                            <div class="min-w-0"><div class="font-black text-lg text-white truncate dir-ltr text-left">@${user.u}</div><div class="text-[10px] text-slate-400 font-mono">${user.i}</div></div>
                        </div>
                        <div class="space-y-1 mb-4 border-t border-slate-800 pt-3">
                            <div class="flex justify-between text-xs"><span class="text-slate-500">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª</span><span class="text-slate-300 dir-ltr">${user.c}</span></div>
                            <div class="flex justify-between text-xs"><span class="text-slate-500">Ø¯Ø³ØªÚ¯Ø§Ù‡</span><span class="text-slate-300 dir-ltr truncate max-w-[150px]">${user.d}</span></div>
                        </div>
                        <div class="bg-slate-800/50 rounded-lg py-2 text-center text-xs text-blue-400 font-bold group-hover:bg-blue-600 group-hover:text-white transition-colors">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª &larr;</div>
                    </div>
                </div>`;
            });
            renderPagination(Math.ceil(filteredData.length / ITEMS_PER_PAGE));
        }

        // --- UPDATED PROFILE LOGIC ---
        function openProfile(username) {
            const raw = Object.entries(fullDatabase).find(([k]) => k.toLowerCase() === username.toLowerCase());
            if(!raw) return;
            const u = raw[0], d = raw[1].data, tags = raw[1].tags || [];
            
            currentProfileUser = u;
            currentProfileId = d.id; // SAVE ID

            document.getElementById('pf-avatar').src = d.avatar || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png";
            document.getElementById('pf-name').innerText = "@" + u;
            document.getElementById('pf-id').innerText = "ID: " + (d.id || "N/A");
            document.getElementById('pf-link-live').href = `https://x.com/${u}`;
            document.getElementById('pf-dev').innerText = d.deviceFull || d.device;
            document.getElementById('pf-date').innerText = d.created;
            document.getElementById('pf-loc').innerText = d.country;
            
            // Set Search Link
            document.getElementById('btn-link-replies').href = `https://x.com/search?q=(from:${u}) filter:replies&src=typed_query&f=live`;

            const tagMap = { 'loc_change': 'ØªØºÛŒÛŒØ± Ù„ÙˆÚ©ÛŒØ´Ù†', 'base_iran': 'Ù…Ø³ØªÙ‚Ø± Ø¯Ø± Ø§ÛŒØ±Ø§Ù†', 'cyber': 'Ø³Ø§ÛŒØ¨Ø±ÛŒ/Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ', 'fake': 'ÙÛŒÚ©/Ø±Ø¨Ø§Øª', 'flag_ir': 'Ù¾Ø±Ú†Ù… Ø§ÛŒØ±Ø§Ù†', 'suspicious': 'Ø±ÙØªØ§Ø± Ù…Ø´Ú©ÙˆÚ©', 'foreigner': 'Ø®Ø§Ø±Ø¬ÛŒ' };
            let tagsHtml = '';
            tags.forEach(t => { tagsHtml += `<span class="px-3 py-1 rounded-lg bg-slate-800 border border-slate-700 text-xs font-bold text-slate-300">${tagMap[t] || t}</span>`; });
            if(d.riskLabel) tagsHtml = `<span class="px-3 py-1 rounded-lg bg-red-900/30 border border-red-500/50 text-red-400 text-xs font-bold">${d.riskLabel === 'ANOMALY' ? 'Ø§ØªØµØ§Ù„ ØºÛŒØ±Ø¹Ø§Ø¯ÛŒ' : d.riskLabel}</span>` + tagsHtml;
            document.getElementById('pf-tags').innerHTML = tagsHtml;
            
            // HIDE PREVIOUS LOGS & CHECK NEW ONES
            document.getElementById('log-viewer').classList.add('hidden');
            checkAvailableLogs(d.id);
            
            switchView('profile');
        }

        async function checkAvailableLogs(id) {
            const container = document.getElementById('log-buttons-container');
            container.innerHTML = '<div class="col-span-full text-center text-xs text-slate-500 py-4 animate-pulse">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯...</div>';
            
            let foundCount = 0;
            let buttonsHtml = '';

            const checks = KNOWN_LOG_TYPES.map(async (type) => {
                try {
                    const res = await fetch(`${LOGS_BASE_URL}/${id}/${type.id}.json`, { method: 'HEAD' });
                    if (res.ok) return type;
                } catch(e) {}
                return null;
            });

            const results = await Promise.all(checks);
            
            results.forEach(type => {
                if (type) {
                    foundCount++;
                    const colorClass = type.color === 'yellow' ? 'text-yellow-500 bg-yellow-900/10 border-yellow-900/30' 
                                     : type.color === 'red' ? 'text-red-400 bg-red-900/10 border-red-900/30'
                                     : type.color === 'blue' ? 'text-blue-400 bg-blue-900/10 border-blue-900/30'
                                     : type.color === 'green' ? 'text-green-400 bg-green-900/10 border-green-900/30'
                                     : 'text-purple-400 bg-purple-900/10 border-purple-900/30';
                                     
                    buttonsHtml += `
                    <button onclick="fetchLog('${type.id}')" class="p-3 border rounded-xl font-bold transition-all flex justify-between items-center group text-sm ${colorClass}">
                        ${type.label}
                        <span class="opacity-50 group-hover:-translate-x-1 transition-transform">â†</span>
                    </button>`;
                }
            });

            if (foundCount === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-xs text-slate-600 py-2">Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù„Ø§Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>';
            } else {
                container.innerHTML = buttonsHtml;
            }
        }

        async function fetchLog(type) {
            if(!currentProfileId) return;
            const viewer = document.getElementById('log-viewer'), status = document.getElementById('log-status'), body = document.getElementById('log-body');
            viewer.classList.remove('hidden');
            status.className = "text-xs font-mono text-yellow-500"; status.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª..."; body.innerHTML = "";
            try {
                const url = `${LOGS_BASE_URL}/${currentProfileId}/${type}.json`;
                const res = await fetch(url);
                if(!res.ok) throw new Error("404");
                const tweets = await res.json();
                status.className = "text-xs font-mono text-green-500"; status.innerText = `${tweets.length} ØªÙˆÛŒÛŒØª ÛŒØ§ÙØª Ø´Ø¯.`;
                
                tweets.forEach(t => {
                    body.innerHTML += `
                    <tr class="hover:bg-slate-800/50 border-b border-slate-800/50">
                        <td class="p-3 whitespace-nowrap text-[10px] text-slate-500 text-right dir-ltr align-top">${t.date}</td>
                        <td class="p-3 text-xs text-right dir-rtl text-slate-300 leading-6 align-top whitespace-pre-wrap">${t.text}</td>
                        <td class="p-3 align-top"><a href="${t.url}" target="_blank" class="text-blue-500 hover:text-blue-400 text-xs">Ù„ÛŒÙ†Ú©</a></td>
                    </tr>`;
                });
            } catch(e) { status.className = "text-xs font-mono text-red-500"; status.innerText = "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„."; }
        }

        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            const nav = document.getElementById('nav-tabs'), hero = document.getElementById('hero-section');
            if(viewName === 'profile') { nav.classList.add('hidden'); hero.classList.add('hidden'); }
            else { nav.classList.remove('hidden'); if(viewName!=='list') hero.classList.add('hidden'); else hero.classList.remove('hidden'); }
            if(viewName !== 'profile') {
                ['list', 'analytics', 'lookup', 'tools'].forEach(v => {
                    const btn = document.getElementById(`tab-${v}`);
                    if(!btn) return;
                    if(v === viewName) { btn.classList.remove('text-slate-400', 'hover:text-white', 'hover:bg-white/5'); btn.classList.add('bg-blue-600', 'text-white', 'shadow-sm'); } 
                    else { btn.classList.add('text-slate-400', 'hover:text-white', 'hover:bg-white/5'); btn.classList.remove('bg-blue-600', 'text-white', 'shadow-sm'); }
                });
            }
        }

        function renderPagination(totalPages) {
            const el = document.getElementById('pagination');
            if (totalPages <= 1) { el.innerHTML = ''; return; }
            el.innerHTML = `<button onclick="changePage(${currentPage - 1})" ${currentPage===1?'disabled class="opacity-30"':''} class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-blue-600 transition-colors">&rarr; ØµÙØ­Ù‡ Ù‚Ø¨Ù„</button><span class="mx-2 bg-slate-900 px-3 py-1 rounded-lg font-mono">${currentPage} / ${totalPages}</span><button onclick="changePage(${currentPage + 1})" ${currentPage===totalPages?'disabled class="opacity-30"':''} class="px-4 py-2 bg-slate-800 rounded-lg hover:bg-blue-600 transition-colors">ØµÙØ­Ù‡ Ø¨Ø¹Ø¯ &larr;</button>`;
        }
        function changePage(p) { currentPage = p; renderList(); document.getElementById('view-list').scrollIntoView({ behavior: 'smooth' }); }
        
        document.getElementById('search-input').addEventListener('input', filterList);
        document.getElementById('sort-select').addEventListener('change', filterList);
        function renderAnalytics(stats) { safeSetText('anl-total', stats.total.toLocaleString('fa-IR')); safeSetText('anl-android', stats.android.toLocaleString('fa-IR')); safeSetText('anl-iphone', stats.iphone.toLocaleString('fa-IR')); safeSetText('anl-web', stats.web.toLocaleString('fa-IR')); }
        function handleJsonTool(input) { const f=input.files[0]; if(!f)return; const r=new FileReader(); r.onload=(e)=>{ try{ const j=JSON.parse(e.target.result); let u=Array.isArray(j)?j.map(i=>i.username||i.Username).filter(x=>x):Object.keys(j); if(u.length===0)return alert("No users"); const b=new Blob([u.join('\n')],{type:'text/plain'}); const l=document.createElement('a'); l.href=URL.createObjectURL(b); l.download='extracted.txt'; l.click(); alert(`Extracted ${u.length}`); }catch(err){alert("Invalid");} }; r.readAsText(f); input.value=""; }
        function handleDumpTool(input) { const f=input.files[0]; if(!f)return; const r=new FileReader(); r.onload=(e)=>{ try{ const t=JSON.parse(e.target.result); document.getElementById('dump-table-body').innerHTML = t.map(x=>`<tr class="hover:bg-slate-800/50"><td class="px-6 py-4 text-xs text-right dir-ltr">${x.date}</td><td class="px-6 py-4 font-bold text-xs text-right">@${x.username}</td><td class="px-6 py-4 text-xs truncate max-w-xs text-right" dir="rtl">${x.text}</td><td class="px-6 py-4 text-xs"><a href="${x.url}" target="_blank" class="text-blue-500">Link</a></td></tr>`).join(''); document.getElementById('dump-result-area').classList.remove('hidden'); }catch(err){alert("Invalid");} }; r.readAsText(f); input.value=""; }
        const lightbox = document.getElementById('lightbox'); function openLightbox(src) { document.getElementById('lightbox-img').src=src.replace("_normal","_orig"); lightbox.classList.remove('hidden'); setTimeout(()=>lightbox.classList.remove('opacity-0'),10); } function closeLightbox() { lightbox.classList.add('opacity-0'); setTimeout(()=>lightbox.classList.add('hidden'),300); }
        function performLookup() { const q=toEnglishDigits(document.getElementById('lookup-input').value.toLowerCase().trim()); const c=document.getElementById('lookup-result'); if(!q)return; let f=Object.entries(fullDatabase).find(([k,v])=>k.toLowerCase()===q||(v.data&&v.data.id===q)); if(f){ openProfile(f[0]); } else { c.innerHTML=`<div class="mt-8 p-6 bg-red-900/10 border border-red-900/30 rounded-2xl text-center text-red-400 font-bold">ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>`; } }
        function prepareReport(data) { const tpl = document.getElementById('export-template'); document.getElementById('exp-u').innerText = '@' + data.u; document.getElementById('exp-i').innerText = data.i; document.getElementById('exp-d').innerText = data.d; document.getElementById('exp-c').innerText = data.c; document.getElementById('exp-l').innerText = data.l; document.getElementById('exp-r').innerText = data.risk; document.getElementById('exp-a').src = data.a || "https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png"; setTimeout(() => { html2canvas(tpl, { useCORS: true, scale: 2, backgroundColor: '#020617', width: 600, height: 600 }).then(canvas => { const link = document.createElement('a'); link.download = `xf-report-${data.u}.png`; link.href = canvas.toDataURL(); link.click(); }); }, 500); }
        
        init();
    </script>
</body>
</html>